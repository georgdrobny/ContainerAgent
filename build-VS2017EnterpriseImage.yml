# Docker image
# Build a Docker image to deploy, run, or push to a container registry.
# Add steps that use Docker Compose, tag images, push to a registry, run an image, and more:
# https://docs.microsoft.com/azure/devops/pipelines/languages/docker

jobs:
- job: 'BuildVS2017EnterpriseImage'
  timeoutInMinutes: 90

  pool:
    vmImage: 'win1803'

  variables:
    imageName: 'vs2017-enterprise'
    imageNameBuild: '$(imageName):$(build.buildId)'
    imageNameLatest: '$(imageName):latest'
    dockerFile: 'ContainerAgent/windows/VS2017Container/Dockerfile.Enterprise'
    buildArguments: '-m 2GB'

  steps:
  - script: |
      docker build -f $(dockerFile) -t $(dockerId).azurecr.io/$(imageNameBuild) -t $(dockerId).azurecr.io/$(imageNameLatest) $(buildArguments) .
      docker login -u $(dockerId) -p $(password) $(dockerId).azurecr.io
      docker push $(dockerId).azurecr.io/$(imageNameBuild)
      docker push $(dockerId).azurecr.io/$(imageNamelatest)
      
